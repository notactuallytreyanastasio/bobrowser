<!DOCTYPE html>
<html>
<head>
    <title>📖 Final Working Bookmarklet</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 700px;
            margin: 50px auto;
            padding: 20px;
            line-height: 1.6;
        }
        .code-area {
            background: #f1f3f4;
            border: 1px solid #dadce0;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 11px;
            margin: 10px 0;
            height: 80px;
            width: 100%;
            resize: vertical;
        }
        .button {
            background: #007aff;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: bold;
        }
        .info {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            color: #1565c0;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>📖 Final Working Bookmarklet</h1>
    
    <div class="success">
        <strong>🎉 Success!</strong><br>
        The diagnostic version worked! Here's the clean final version for daily use.
    </div>
    
    <div class="info">
        <strong>📋 How to Use:</strong><br>
        1. Click bookmarklet on any article page<br>
        2. Switch to Reader View if you want clean content<br>
        3. See "✅ Saved!" notification in top-right corner<br>
        4. Check saved articles with: <code>./quick-test.sh</code>
    </div>
    
    <h3>Final Clean Bookmarklet (no debug alerts):</h3>
    <textarea class="code-area" id="finalCode" readonly>javascript:(function(){try{console.log('📖 Reader Tracker: Starting save...');var n=document.createElement('div');n.style.cssText='position:fixed;top:20px;right:20px;background:#4CAF50;color:white;padding:15px 20px;border-radius:8px;z-index:10000;font-family:system-ui;font-size:14px;box-shadow:0 4px 12px rgba(0,0,0,0.3);max-width:300px;';n.textContent='🔄 Saving article...';document.body.appendChild(n);setTimeout(function(){try{var title=document.querySelector('h1')?document.querySelector('h1').textContent:document.title;var content=document.querySelector('article')||document.querySelector('main')||document.body;var text=content.textContent||'';var cleanText=text.replace(/\s+/g,' ').trim();var words=cleanText.split(/\s+/).filter(function(w){return w.length>0}).length;console.log('📊 Extracted:',words,'words from',title.substring(0,50));if(words<10){n.textContent='❌ Article too short: '+words+' words';n.style.background='#f44336';setTimeout(function(){n.remove()},4000);return}var origUrl=document.querySelector('meta[property="og:url"]')||document.querySelector('link[rel="canonical"]');var data={url:origUrl?(origUrl.content||origUrl.href):window.location.href,title:title.trim(),content:content.innerHTML,textContent:cleanText,wordCount:words,readingTime:Math.ceil(words/200)*1000,publishDate:new Date().toISOString(),tags:'reader-view'};var xhr=new XMLHttpRequest();xhr.open('POST','http://127.0.0.1:3002/api/articles',true);xhr.setRequestHeader('Content-Type','application/json');xhr.onload=function(){console.log('📡 Server response:',xhr.status);if(xhr.status===200){n.textContent='✅ Saved! '+words+' words, '+Math.ceil(words/200)+' min read';n.style.background='#4CAF50'}else{n.textContent='❌ Save failed: HTTP '+xhr.status;n.style.background='#f44336'}setTimeout(function(){n.remove()},4000)};xhr.send(JSON.stringify(data))}catch(e){console.error('❌ Extraction error:',e);n.textContent='❌ Error: '+e.message;n.style.background='#f44336';setTimeout(function(){n.remove()},4000)}},100)}catch(e){console.error('❌ Bookmarklet error:',e);alert('❌ Error: '+e.message)}})();</textarea>
    
    <button class="button" onclick="copyToClipboard()">📋 Copy Final Version</button>
    
    <div class="success">
        <strong>✅ Features:</strong><br>
        • Works on any article page<br>
        • Shows progress notification (top-right corner)<br>
        • Extracts clean content<br>
        • Validates minimum word count<br>
        • Uses original URL when available<br>
        • Logs details to console for debugging
    </div>
    
    <h3>Usage Tips:</h3>
    <ul>
        <li><strong>Reader View:</strong> Switch to Reader View for cleanest content (but not required)</li>
        <li><strong>Check saves:</strong> Run <code>./quick-test.sh</code> to see saved articles</li>
        <li><strong>View logs:</strong> Open Web Inspector → Console for detailed info</li>
        <li><strong>Server:</strong> Make sure <code>./start.sh</code> is running</li>
    </ul>

    <script>
        function copyToClipboard() {
            const textarea = document.getElementById('finalCode');
            textarea.select();
            document.execCommand('copy');
            
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = '✅ Copied!';
            button.style.background = '#28a745';
            setTimeout(() => {
                button.textContent = originalText;
                button.style.background = '#007aff';
            }, 2000);
        }
    </script>
</body>
</html>