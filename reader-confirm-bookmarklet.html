<!DOCTYPE html>
<html>
<head>
    <title>üìñ Reader Confirm Bookmarklet</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 700px;
            margin: 50px auto;
            padding: 20px;
            line-height: 1.6;
        }
        .code-box {
            background: #f1f3f4;
            border: 1px solid #dadce0;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 11px;
            overflow-x: auto;
            margin: 10px 0;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .button {
            background: #007aff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        .info {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            color: #1565c0;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>üìñ Reader Confirm Bookmarklet</h1>
    
    <div class="warning">
        <strong>üîç Discovery</strong><br>
        Safari Reader View doesn't change the URL or add detectable classes. We'll use user confirmation instead.
    </div>
    
    <div class="info">
        <strong>üìã How it works:</strong><br>
        1. Click bookmarklet on any article page<br>
        2. It asks "Are you in Reader View?"<br>
        3. If yes, it saves the article<br>
        4. If no, it reminds you to switch first
    </div>
    
    <h3>Step 1: Copy this bookmarklet code</h3>
    <div class="code-box" id="bookmarkletCode">javascript:(function(){try{if(!confirm('üìñ Are you currently in Safari Reader View?\n\nClick OK if yes, Cancel if no.')){alert('‚ùå Please switch to Reader View first, then try again.');return}var n=document.createElement('div');n.style.cssText='position:fixed;top:20px;right:20px;background:#4CAF50;color:white;padding:15px 20px;border-radius:8px;z-index:10000;font-family:system-ui;font-size:14px;box-shadow:0 4px 12px rgba(0,0,0,0.3);';n.textContent='üîÑ Extracting article...';document.body.appendChild(n);var t=document.querySelector('h1')||document.querySelector('.title')||document.querySelector('[class*=title]')||{textContent:document.title.replace(/\s*[-|]\s*.*$/,'')};var c=document.querySelector('article')||document.querySelector('main')||document.querySelector('.content')||document.body;var txt=(c.textContent||'').replace(/\s+/g,' ').replace(/[\u00A0-\u00FF]/g,' ').trim();var words=txt.split(' ').filter(function(w){return w.length>0});var wc=words.length;console.log('üìä Extracted:',{title:t.textContent,wordCount:wc,contentLength:txt.length});if(!t.textContent||t.textContent.trim().length<3){n.textContent='‚ùå No title found';setTimeout(function(){n.remove()},3000);return}if(wc<10){n.textContent='‚ùå Too short: '+wc+' words';setTimeout(function(){n.remove()},3000);return}var ogUrl=document.querySelector('meta[property="og:url"]')||document.querySelector('meta[name="twitter:url"]')||document.querySelector('link[rel="canonical"]');var origUrl=ogUrl?(ogUrl.content||ogUrl.href):window.location.href;var auth=document.querySelector('[class*=author]')||document.querySelector('.byline')||document.querySelector('[rel=author]');var data={url:origUrl,title:t.textContent.trim(),author:auth?auth.textContent.trim():null,publishDate:new Date().toISOString(),content:c.innerHTML,textContent:txt,wordCount:wc,readingTime:Math.ceil(wc/200)*1000,tags:'reader-view'};n.textContent='üì° Saving to tracker...';var x=new XMLHttpRequest();x.open('POST','http://127.0.0.1:3002/api/articles',true);x.setRequestHeader('Content-Type','application/json');x.onreadystatechange=function(){if(x.readyState===4){if(x.status===200){n.textContent='‚úÖ Saved! '+wc+' words, '+Math.ceil(wc/200)+' min read';n.style.background='#4CAF50'}else{n.textContent='‚ùå Save failed: HTTP '+x.status;n.style.background='#f44336'}setTimeout(function(){n.remove()},4000)}};x.send(JSON.stringify(data))}catch(e){console.error('Bookmarklet error:',e);alert('‚ùå Error: '+e.message)}})();</div>
    
    <button class="button" onclick="copyToClipboard()">üìã Copy Bookmarklet Code</button>
    
    <h3>Step 2: Create bookmark</h3>
    <ol>
        <li>Safari ‚Üí Bookmarks ‚Üí Add Bookmark</li>
        <li>Name: <strong>üìñ Save Reader Article</strong></li>
        <li>Replace URL with the copied code above</li>
    </ol>
    
    <h3>Step 3: Usage</h3>
    <ol>
        <li>Visit any article (like news.ycombinator.com)</li>
        <li><strong>Switch to Reader View</strong> (click the Reader icon in address bar)</li>
        <li>Click your "üìñ Save Reader Article" bookmark</li>
        <li>When asked "Are you in Reader View?", click <strong>OK</strong></li>
        <li>Should see "‚úÖ Saved!" notification</li>
    </ol>
    
    <div class="info">
        <strong>‚úÖ This version:</strong><br>
        ‚Ä¢ Works on any page (no URL detection)<br>
        ‚Ä¢ Asks user to confirm Reader View<br>
        ‚Ä¢ Extracts clean content from Reader View<br>
        ‚Ä¢ Shows detailed progress notifications<br>
        ‚Ä¢ Logs extraction info to console
    </div>

    <script>
        function copyToClipboard() {
            const codeElement = document.getElementById('bookmarkletCode');
            const range = document.createRange();
            range.selectNodeContents(codeElement);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            document.execCommand('copy');
            selection.removeAllRanges();
            
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = '‚úÖ Copied!';
            button.style.background = '#28a745';
            setTimeout(() => {
                button.textContent = originalText;
                button.style.background = '#007aff';
            }, 2000);
        }
    </script>
</body>
</html>