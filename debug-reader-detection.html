<!DOCTYPE html>
<html>
<head>
    <title>üìñ Debug Reader Detection</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            max-width: 700px;
            margin: 50px auto;
            padding: 20px;
            line-height: 1.6;
        }
        .code-box {
            background: #f1f3f4;
            border: 1px solid #dadce0;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 11px;
            overflow-x: auto;
            margin: 10px 0;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .button {
            background: #007aff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        .info {
            background: #e3f2fd;
            border: 1px solid #bbdefb;
            color: #1565c0;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>üìñ Debug Reader Detection</h1>
    
    <div class="info">
        <strong>üîç Debug Tool</strong><br>
        This bookmarklet will tell you exactly what Safari Reader View looks like to help fix the detection.
    </div>
    
    <h3>Instructions:</h3>
    <ol>
        <li>Copy the debug bookmarklet below</li>
        <li>Create a bookmark with this code</li>
        <li>Go to any article and switch to Reader View</li>
        <li>Click the debug bookmark</li>
        <li>It will show you all the detection info</li>
    </ol>
    
    <h3>Debug Bookmarklet:</h3>
    <div class="code-box" id="debugCode">javascript:(function(){var info='üîç READER VIEW DEBUG INFO:\n\n';info+='URL: '+window.location.href+'\n';info+='Protocol: '+window.location.protocol+'\n';info+='Host: '+window.location.host+'\n\n';info+='Body classes: '+(document.body.className||'none')+'\n';info+='Body has safari-reader class: '+(document.body.classList.contains('safari-reader'))+'\n';info+='Body data-safari-reader: '+(document.body.getAttribute('data-safari-reader')||'none')+'\n\n';info+='Document title: '+document.title+'\n';info+='Has h1: '+(!!document.querySelector('h1'))+'\n';info+='Has article: '+(!!document.querySelector('article'))+'\n\n';var checks=[];checks.push('safari-reader protocol: '+(window.location.protocol==='safari-reader:'));checks.push('safari-reader in URL: '+window.location.href.includes('safari-reader'));checks.push('body has safari-reader class: '+document.body.classList.contains('safari-reader'));checks.push('body data-safari-reader attr: '+!!document.querySelector('body[data-safari-reader]'));checks.push('any reader indication: '+(window.location.protocol==='safari-reader:'||window.location.href.includes('safari-reader')||document.body.classList.contains('safari-reader')||!!document.querySelector('body[data-safari-reader]')));info+='\nREADER CHECKS:\n'+checks.join('\n');alert(info);console.log(info)})();</div>
    
    <button class="button" onclick="copyDebugCode()">üìã Copy Debug Code</button>
    
    <h3>Fixed Bookmarklet (use after debugging):</h3>
    <div class="code-box" id="fixedCode">javascript:(function(){try{var isReader=window.location.protocol==='safari-reader:'||window.location.href.includes('safari-reader')||document.body.classList.contains('safari-reader')||!!document.querySelector('body[data-safari-reader]')||document.body.style.fontSize||document.querySelector('.safari-reader');console.log('Reader check:',isReader);if(!isReader){alert('‚ùå Reader View required! Current: '+window.location.href.substring(0,50));return}var n=document.createElement('div');n.style.cssText='position:fixed;top:20px;right:20px;background:#4CAF50;color:white;padding:15px;border-radius:8px;z-index:10000;font-size:14px;';n.textContent='üîÑ Saving...';document.body.appendChild(n);var t=document.querySelector('h1')||{textContent:document.title};var c=document.querySelector('article')||document.querySelector('main')||document.body;var txt=(c.textContent||'').replace(/\s+/g,' ').trim();var wc=txt.split(' ').filter(function(w){return w.length>0}).length;if(wc<10){n.textContent='‚ùå Too short: '+wc+' words';return}var ogUrl=document.querySelector('meta[property="og:url"]');var data={url:ogUrl?ogUrl.content:prompt('Original URL?',window.location.href),title:t.textContent.trim(),content:c.innerHTML,textContent:txt,wordCount:wc,readingTime:Math.ceil(wc/200)*1000,publishDate:new Date().toISOString(),tags:'reader-view'};var x=new XMLHttpRequest();x.open('POST','http://127.0.0.1:3002/api/articles');x.setRequestHeader('Content-Type','application/json');x.onload=function(){n.textContent=x.status==200?'‚úÖ Saved! '+wc+' words':'‚ùå Failed: '+x.status;setTimeout(function(){n.remove()},4000)};x.send(JSON.stringify(data))}catch(e){alert('‚ùå Error: '+e.message)}})();</div>
    
    <button class="button" onclick="copyFixedCode()">üìã Copy Fixed Code</button>

    <script>
        function copyDebugCode() {
            copyToClipboard('debugCode', event.target);
        }
        
        function copyFixedCode() {
            copyToClipboard('fixedCode', event.target);
        }
        
        function copyToClipboard(elementId, button) {
            const codeElement = document.getElementById(elementId);
            const range = document.createRange();
            range.selectNodeContents(codeElement);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            document.execCommand('copy');
            selection.removeAllRanges();
            
            const originalText = button.textContent;
            button.textContent = '‚úÖ Copied!';
            button.style.background = '#28a745';
            setTimeout(() => {
                button.textContent = originalText;
                button.style.background = '#007aff';
            }, 2000);
        }
    </script>
</body>
</html>